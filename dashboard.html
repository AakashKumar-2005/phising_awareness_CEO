<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <style>
    /* Basic styles for the page */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
    }

    h1 {
      text-align: center;
    }

    h2 {
      margin-top: 30px;
    }

    /* Pie chart container */
    .pie-chart-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto;
      border-radius: 50%;
      background-image: conic-gradient;
    }

    /* Data table styles */
    table {
      width: 100%;
      margin-top: 30px;
      border-collapse: collapse;
    }

    th, td {
      padding: 8px 12px;
      border: 1px solid #ddd;
      text-align: center;
    }

    th {
      background-color: #f2f2f2;
    }

    /* Filter form styles */
    .filter-form {
      text-align: center;
      margin-top: 20px;
    }
  </style>
</head>
<body>

  <h1>Admin Dashboard</h1>

  <!-- Pie Chart Container -->
  <div class="pie-chart-container" id="piechart">
    <!-- Dynamic pie chart will be rendered here -->
  </div>

  <h2>Employee Data</h2>
  <!-- Table to Display Employee Data -->
  <table>
    <thead>
      <tr>
        <th>Email</th>
        <th>Name</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for row in data %}
        <tr>
          <td>{{ row['Email'] }}</td>
          <td>{{ row['Name'] }}</td>
          <td>{{ row['Status'] }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <h3>Filter by Status</h3>
  <div class="filter-form">
    <form action="/filter" method="get">
      <label for="status">Choose Status:</label>
      <select name="status" id="status">
        <option value="unseen">Unseen</option>
        <option value="Seen the email">Seen</option>
        <option value="Seen the email and Opened it">Opened</option>
      </select>
      <button type="submit">Filter</button>
    </form>
  </div>

  <script>
    // Data from Flask passed into JavaScript variables
    var pieLabels = {{ pie_data.labels | tojson }};
    var pieData = {{ pie_data.data | tojson }};
    
    // Function to draw the dynamic pie chart
    function drawPieChart() {
      var total = pieData.reduce((sum, value) => sum + value, 0);
      var angleOffset = 0;

      // Container where the pie chart will be rendered
      var pieChart = document.getElementById('piechart');
      pieChart.style.backgroundImage = '';  // Reset before drawing

      // Loop over the pie data to create each segment
      pieData.forEach(function (value, index) {
        var angle = (value / total) * 360; // Calculate the angle for this segment
        var color = getColorForSegment(index);

        // Set the CSS for the pie chart
        pieChart.style.backgroundImage += `${color} ${angleOffset}deg ${angle + angleOffset}deg,`;
        angleOffset += angle;
      });
    }

    // Function to return the color for each segment
    function getColorForSegment(index) {
      switch(index) {
        case 0: return 'red';     // Unseen
        case 1: return 'yellow';  // Seen
        case 2: return 'green';   // Opened
        default: return 'gray';   // Default color
      }
    }

    // Call the function to draw the pie chart
    drawPieChart();
  </script>

</body>
</html>
